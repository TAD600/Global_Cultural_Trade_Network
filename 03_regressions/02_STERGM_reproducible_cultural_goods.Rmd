---
title: "STERGM on reproducible cultural goods trade"
author: "Author"
date: "2025-06-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

** Before excecuting this file I will clear all objects from the workspace and unload all packages from the currect environment with the following codes.**`
```{r}
#Reference: https://www.r-bloggers.com/2024/03/unload-all-packages-in-r-best-practices/
#install.packages("pacman")
#pacman::p_unload(pacman::p_loaded(), character.only = TRUE) 
```

# Steps of STERGM:

1. Loading `network`, `igraph`, `intergraph` and `reshape2` packages
2. Making the distance network as a network object with edge weights as distances
3. Making three adjacency matrices with binary values for common colonizer, common language, and contiguity
4. Defining a function to add node attributes to the networks
5. Loading the edgelist of reproducible cultural goods, and making 24 network objects for 24 consecutive years following the steps,     + Keeping only the pairs with positive weights
    + Subsetting the dataframe with only 'iso_o' and 'iso_d' column
    + Making an igraph object and assigning node attributes from the function created in the third step
    + Sanity checking (is the node names character objects, is the number of node names equal to the number of nodes, the  names of the node attributes etc.)
    + Repeating the above four steps for all the years.
6. Detaching the igraph package and loading `sna` and `tergm` packages
7. Converting all 24 igraph objects to network objects
8. Checking the node attributes for all of the networks
9. Running STERGM 
10. Calculating odds ratios, standard errors, and confidence intervals
11. Plotting goodness of fit and MCMC statistics

```{r}
library(network)
library(igraph)
library(intergraph)
library(reshape2)
```

```{r}
lang <- read.csv("../data/cleaned/language_edgelist.csv",stringsAsFactors = FALSE)
lang_mat <- acast(lang, iso_o ~ iso_d, value.var = "comlang_off", fill = 0)

contiguity <- read.csv("../data/cleaned/contiguity_edgelist.csv",stringsAsFactors = FALSE)
contig_mat <- acast(contiguity, iso_o ~ iso_d, value.var = "contig", fill = 0)

common_col <- read.csv("../data/cleaned/comcol_edgelist.csv",stringsAsFactors = FALSE)
col_mat <- acast(common_col, iso_o ~ iso_d, value.var = "comcol", fill = 0)

colonizer <- read.csv("../data/cleaned/colonizer_edgelist.csv",stringsAsFactors = FALSE)
colony <- acast(colonizer, iso_o ~ iso_d, value.var = "colony", fill = 0)
```


```{r}
dist_1 <- read.csv("../data/cleaned/distance_edgelist.csv",stringsAsFactors = FALSE)
dist_net <- network(dist_1[, c("iso_o", "iso_d")], 
                   directed = TRUE, 
                   matrix.type = "edgelist", 
                   loops = FALSE)

set.edge.value(dist_net, "log_dist", dist_1$log_dist)
```

```{r}
class(dist_net)
```
# Unique culture Goods trade edgelist
```{r}
r <- read.csv("../data/cleaned/reproducible_edgelist.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
```

# 2000
```{r}
y0 <- "X2000"
r_y00 <- r[, c("iso_o", "iso_d", y0)]
r_y00 <- subset(r_y00, r_y00[[y0]] > 0)
r_y0 <- r_y00[, c('iso_o', 'iso_d')]

att2000 <- read.csv("../data/cleaned/attribute2000.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re00 <- graph_from_data_frame(d = r_y0, directed = TRUE)

attify <- function(n_net, attr_df){
  V(n_net)$iso_o <- V(n_net)$name
  idx <- match(V(n_net)$name, attr_df$iso_o)
  V(n_net)$country <- attr_df$Country[idx]
  V(n_net)$D_log_gdp <- attr_df$D_log_gdp[idx]
  V(n_net)$D_log_gdp_pct <- attr_df$D_log_gdp_pct[idx]
  V(n_net)$log_population <- attr_df$log_population[idx]
  V(n_net)$log_trade_gdp_ratio <- attr_df$log_trade_gdp_ratio[idx]
  V(n_net)$landlocked <- attr_df$landlocked[idx]
  V(n_net)$continent <- attr_df$continent[idx]
  V(n_net)$lat <- attr_df$lat[idx]
  V(n_net)$lon <- attr_df$lon[idx]
  V(n_net)$development <- attr_df$development[idx]
  
  return(n_net)
}

re00 <- attify(re00, att2000)
vertex_attr_names(re00)

summary(re00)
length(unique(V(re00)$name)) == gorder(re00) 
is.character(V(re00)$name) 
length(unique(att2000$iso_o)) == length(unique(V(re00)$name))
```

# 2001
```{r}
y1 <- "X2001"
r_y01 <- r[, c("iso_o", "iso_d", y1)]
r_y01 <- subset(r_y01, r_y01[[y1]] > 0)
r_y1 <- r_y01[, c('iso_o', 'iso_d')]
att2001 <- read.csv("../data/cleaned/attribute2001.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re01 <- graph_from_data_frame(d = r_y1, directed = TRUE)
re01 <- attify(re01, att2001)
vertex_attr_names(re01)

summary(re01)
length(unique(V(re01)$name)) == gorder(re01)
is.character(V(re01)$name) 
length(unique(att2001$iso_o)) == length(unique(V(re01)$name))
```
# 2002
```{r}
y2 <- "X2002"
r_y02 <- r[, c("iso_o", "iso_d", y2)]
r_y02 <- subset(r_y02, r_y02[[y2]] > 0)
r_y2 <- r_y02[, c('iso_o', 'iso_d')]
att2002 <- read.csv("../data/cleaned/attribute2002.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re02 <- graph_from_data_frame(d = r_y2, directed = TRUE)
re02 <- attify(re02, att2002)
vertex_attr_names(re02)

summary(re02)
length(unique(V(re02)$name)) == gorder(re02)
is.character(V(re02)$name) 
length(unique(att2002$iso_o)) == length(unique(V(re02)$name))
```
# 2003
```{r}
y3 <- "X2003"
r_y03 <- r[, c("iso_o", "iso_d", y3)]
r_y03 <- subset(r_y03, r_y03[[y3]] > 0)
r_y3 <- r_y03[, c('iso_o', 'iso_d')]
att2003 <- read.csv("../data/cleaned/attribute2003.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re03 <- graph_from_data_frame(d = r_y3, directed = TRUE)
re03 <- attify(re03, att2003)
vertex_attr_names(re03)
summary(re03)
length(unique(V(re03)$name)) == gorder(re03)
is.character(V(re03)$name) 
length(unique(att2003$iso_o)) == length(unique(V(re03)$name))
```
# 2004
```{r}
y4 <- "X2004"
r_y04 <- r[, c("iso_o", "iso_d", y4)]
r_y04 <- subset(r_y04, r_y04[[y4]] > 0)
r_y4 <- r_y04[, c('iso_o', 'iso_d')]
att2004 <- read.csv("../data/cleaned/attribute2004.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re04 <- graph_from_data_frame(d = r_y4, directed = TRUE)
re04 <- attify(re04, att2004)
vertex_attr_names(re04)
summary(re04)
length(unique(V(re04)$name)) == gorder(re04)
is.character(V(re04)$name) 
length(unique(att2004$iso_o)) == length(unique(V(re04)$name))
```
# 2005
```{r}
y5 <- "X2005"
r_y05 <- r[, c("iso_o", "iso_d", y5)]
r_y05 <- subset(r_y05, r_y05[[y5]] > 0)
r_y5 <- r_y05[, c('iso_o', 'iso_d')]
att2005 <- read.csv("../data/cleaned/attribute2005.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re05 <- graph_from_data_frame(d = r_y5, directed = TRUE)
re05 <- attify(re05, att2005)
vertex_attr_names(re05)
summary(re05)
length(unique(V(re05)$name)) == gorder(re05)
is.character(V(re05)$name) 
length(unique(att2005$iso_o)) == length(unique(V(re05)$name))
```
# 2006
```{r}
y6 <- "X2006"
r_y06 <- r[, c("iso_o", "iso_d", y6)]
r_y06 <- subset(r_y06, r_y06[[y6]] > 0)
r_y6 <- r_y06[, c('iso_o', 'iso_d')]
att2006 <- read.csv("../data/cleaned/attribute2006.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re06 <- graph_from_data_frame(d = r_y6, directed = TRUE)
re06 <- attify(re06, att2006)
vertex_attr_names(re06)
summary(re06)
length(unique(V(re06)$name)) == gorder(re06)
is.character(V(re06)$name) 
length(unique(att2006$iso_o)) == length(unique(V(re06)$name))
```

# 2007
```{r}
y7 <- "X2007"
r_y07 <- r[, c("iso_o", "iso_d", y7)]
r_y07 <- subset(r_y07, r_y07[[y7]] > 0)
r_y7 <- r_y07[, c('iso_o', 'iso_d')]
att2007 <- read.csv("../data/cleaned/attribute2007.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re07 <- graph_from_data_frame(d = r_y7, directed = TRUE)
re07 <- attify(re07, att2007)
vertex_attr_names(re07)
summary(re07)
length(unique(V(re07)$name)) == gorder(re07)
is.character(V(re07)$name) 
length(unique(att2007$iso_o)) == length(unique(V(re07)$name))
```
# 2008
```{r}
y8 <- "X2008"
r_y08 <- r[, c("iso_o", "iso_d", y8)]
r_y08 <- subset(r_y08, r_y08[[y8]] > 0)
r_y8 <- r_y08[, c('iso_o', 'iso_d')]
att2008 <- read.csv("../data/cleaned/attribute2008.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re08 <- graph_from_data_frame(d = r_y8, directed = TRUE)
re08 <- attify(re08, att2008)
vertex_attr_names(re08)
summary(re08)
length(unique(V(re08)$name)) == gorder(re08)
is.character(V(re08)$name) 
length(unique(att2008$iso_o)) == length(unique(V(re08)$name))
```
# 2009
```{r}
y9 <- "X2009"
r_y09 <- r[, c("iso_o", "iso_d", y9)]
r_y09 <- subset(r_y09, r_y09[[y9]] > 0)
r_y9 <- r_y09[, c('iso_o', 'iso_d')]
att2009 <- read.csv("../data/cleaned/attribute2009.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re09 <- graph_from_data_frame(d = r_y9, directed = TRUE)
re09 <- attify(re09, att2009)
vertex_attr_names(re09)
summary(re09)
length(unique(V(re09)$name)) == gorder(re09)
is.character(V(re09)$name) 
length(unique(att2009$iso_o)) == length(unique(V(re09)$name))
```
# 2010
```{r}
y10 <- "X2010"
r_y010 <- r[, c("iso_o", "iso_d", y10)]
r_y010 <- subset(r_y010, r_y010[[y10]] > 0)
r_y10 <- r_y010[, c('iso_o', 'iso_d')]
att2010 <- read.csv("../data/cleaned/attribute2010.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re10 <- graph_from_data_frame(d = r_y10, directed = TRUE)
re10 <- attify(re10, att2010)
vertex_attr_names(re10)
summary(re10)
length(unique(V(re10)$name)) == gorder(re10)
is.character(V(re10)$name) 
length(unique(att2010$iso_o)) == length(unique(V(re10)$name))
```
# 2011
```{r}
y11 <- "X2011"
r_y011 <- r[, c("iso_o", "iso_d", y11)]
r_y011 <- subset(r_y011, r_y011[[y11]] > 0)
r_y11 <- r_y011[, c('iso_o', 'iso_d')]
att2011 <- read.csv("../data/cleaned/attribute2011.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re11 <- graph_from_data_frame(d = r_y11, directed = TRUE)
re11 <- attify(re11, att2011)
vertex_attr_names(re11)
summary(re11)
length(unique(V(re11)$name)) == gorder(re11)
is.character(V(re11)$name) 
length(unique(att2011$iso_o)) == length(unique(V(re11)$name))
```
# 2012
```{r}
y12 <- "X2012"
r_y012 <- r[, c("iso_o", "iso_d", y12)]
r_y012 <- subset(r_y012, r_y012[[y12]] > 0)
r_y12 <- r_y012[, c('iso_o', 'iso_d')]
att2012 <- read.csv("../data/cleaned/attribute2012.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re12 <- graph_from_data_frame(d = r_y12, directed = TRUE)
re12 <- attify(re12, att2012)
vertex_attr_names(re12)
summary(re12)
length(unique(V(re12)$name)) == gorder(re12)
is.character(V(re12)$name) 
length(unique(att2012$iso_o)) == length(unique(V(re12)$name))
```
# 2013
```{r}
y13 <- "X2013"
r_y013 <- r[, c("iso_o", "iso_d", y13)]
r_y013 <- subset(r_y013, r_y013[[y13]] > 0)
r_y13 <- r_y013[, c('iso_o', 'iso_d')]
att2013 <- read.csv("../data/cleaned/attribute2013.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re13 <- graph_from_data_frame(d = r_y13, directed = TRUE)
re13 <- attify(re13, att2013)
vertex_attr_names(re13)
summary(re13)
length(unique(V(re13)$name)) == gorder(re13)
is.character(V(re13)$name) 
length(unique(att2013$iso_o)) == length(unique(V(re13)$name))
```
# 2014
```{r}
y14 <- "X2014"
r_y014 <- r[, c("iso_o", "iso_d", y14)]
r_y014 <- subset(r_y014, r_y014[[y14]] > 0)
r_y14 <- r_y014[, c('iso_o', 'iso_d')]
att2014 <- read.csv("../data/cleaned/attribute2014.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re14 <- graph_from_data_frame(d = r_y14, directed = TRUE)
re14 <- attify(re14, att2014)
vertex_attr_names(re14)
summary(re14)
length(unique(V(re14)$name)) == gorder(re14)
is.character(V(re14)$name) 
length(unique(att2014$iso_o)) == length(unique(V(re14)$name))
```
# 2015
```{r}
y15 <- "X2015"
r_y015 <- r[, c("iso_o", "iso_d", y15)]
r_y015 <- subset(r_y015, r_y015[[y15]] > 0)
r_y15 <- r_y015[, c('iso_o', 'iso_d')]
att2015 <- read.csv("../data/cleaned/attribute2015.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re15 <- graph_from_data_frame(d = r_y15, directed = TRUE)
re15 <- attify(re15, att2015)
vertex_attr_names(re15)
summary(re15)
length(unique(V(re15)$name)) == gorder(re15)
is.character(V(re15)$name) 
length(unique(att2015$iso_o)) == length(unique(V(re15)$name))
```
# 2016
```{r}
y16 <- "X2016"
r_y016 <- r[, c("iso_o", "iso_d", y16)]
r_y016 <- subset(r_y016, r_y016[[y16]] > 0)
r_y16 <- r_y016[, c('iso_o', 'iso_d')]
att2016 <- read.csv("../data/cleaned/attribute2016.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re16 <- graph_from_data_frame(d = r_y16, directed = TRUE)
re16 <- attify(re16, att2016)
vertex_attr_names(re16)
summary(re16)
length(unique(V(re16)$name)) == gorder(re16)
is.character(V(re16)$name) 
length(unique(att2016$iso_o)) == length(unique(V(re16)$name))
```

# 2017
```{r}
y17 <- "X2017"
r_y017 <- r[, c("iso_o", "iso_d", y17)]
r_y017 <- subset(r_y017, r_y017[[y17]] > 0)
r_y17 <- r_y017[, c('iso_o', 'iso_d')]
att2017 <- read.csv("../data/cleaned/attribute2017.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re17 <- graph_from_data_frame(d = r_y17, directed = TRUE)
re17 <- attify(re17, att2017)
vertex_attr_names(re17)
summary(re17)
length(unique(V(re17)$name)) == gorder(re17)
is.character(V(re17)$name) 
length(unique(att2017$iso_o)) == length(unique(V(re17)$name))
```
# 2018
```{r}
y18 <- "X2018"
r_y018 <- r[, c("iso_o", "iso_d", y18)]
r_y018 <- subset(r_y018, r_y018[[y18]] > 0)
r_y18 <- r_y018[, c('iso_o', 'iso_d')]
att2018 <- read.csv("../data/cleaned/attribute2018.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re18 <- graph_from_data_frame(d = r_y18, directed = TRUE)
re18 <- attify(re18, att2018)
vertex_attr_names(re18)
summary(re18)
length(unique(V(re18)$name)) == gorder(re18)
is.character(V(re18)$name) 
length(unique(att2018$iso_o)) == length(unique(V(re18)$name))
```
# 2019
```{r}
y19 <- "X2019"
r_y019 <- r[, c("iso_o", "iso_d", y19)]
r_y019 <- subset(r_y019, r_y019[[y19]] > 0)
r_y19 <- r_y019[, c('iso_o', 'iso_d')]
att2019 <- read.csv("../data/cleaned/attribute2019.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re19 <- graph_from_data_frame(d = r_y19, directed = TRUE)
re19 <- attify(re19, att2019)
vertex_attr_names(re19)
summary(re19)
length(unique(V(re19)$name)) == gorder(re19)
is.character(V(re19)$name) 
length(unique(att2019$iso_o)) == length(unique(V(re19)$name))
```
# 2020
```{r}
y20 <- "X2020"
r_y020 <- r[, c("iso_o", "iso_d", y20)]
r_y020 <- subset(r_y020, r_y020[[y20]] > 0)
r_y20 <- r_y020[, c('iso_o', 'iso_d')]
att2020 <- read.csv("../data/cleaned/attribute2020.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re20 <- graph_from_data_frame(d = r_y20, directed = TRUE)
re20 <- attify(re20, att2020)
vertex_attr_names(re20)
summary(re20)
length(unique(V(re20)$name)) == gorder(re20)
is.character(V(re20)$name) 
length(unique(att2020$iso_o)) == length(unique(V(re20)$name))
```

# 2021
```{r}
y21 <- "X2021"
r_y021 <- r[, c("iso_o", "iso_d", y21)]
r_y021 <- subset(r_y021, r_y021[[y21]] > 0)
r_y21 <- r_y021[, c('iso_o', 'iso_d')]
att2021 <- read.csv("../data/cleaned/attribute2021.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re21 <- graph_from_data_frame(d = r_y21, directed = TRUE)
re21 <- attify(re21, att2021)
vertex_attr_names(re21)
summary(re21)
length(unique(V(re21)$name)) == gorder(re21)
is.character(V(re21)$name) 
length(unique(att2021$iso_o)) == length(unique(V(re21)$name))
```
# 2022
```{r}
y22 <- "X2022"
r_y022 <- r[, c("iso_o", "iso_d", y22)]
r_y022 <- subset(r_y022, r_y022[[y22]] > 0)
r_y22 <- r_y022[, c('iso_o', 'iso_d')]
att2022 <- read.csv("../data/cleaned/attribute2022.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re22 <- graph_from_data_frame(d = r_y22, directed = TRUE)
re22 <- attify(re22, att2022)
vertex_attr_names(re22)
summary(re22)
length(unique(V(re22)$name)) == gorder(re22)
is.character(V(re22)$name) 
length(unique(att2022$iso_o)) == length(unique(V(re22)$name))
```

# 2023
```{r}
y23 <- "X2023"
r_y023 <- r[, c("iso_o", "iso_d", y23)]
r_y023 <- subset(r_y023, r_y023[[y23]] > 0)
r_y23 <- r_y023[, c('iso_o', 'iso_d')]
att2023 <- read.csv("../data/cleaned/attribute2023.csv", header = TRUE, as.is = TRUE, stringsAsFactors = FALSE)
re23 <- graph_from_data_frame(d = r_y23, directed = TRUE)
re23 <- attify(re23, att2023)
vertex_attr_names(re23)
summary(re23)
length(unique(V(re23)$name)) == gorder(re23)
is.character(V(re23)$name) 
length(unique(att2023$iso_o)) == length(unique(V(re23)$name))
```

# Converting to network object,
```{r}
net_re00 <- intergraph::asNetwork(re00)
net_re01 <- intergraph::asNetwork(re01)
net_re02 <- intergraph::asNetwork(re02)
net_re03 <- intergraph::asNetwork(re03)
net_re04 <- intergraph::asNetwork(re04)
net_re05 <- intergraph::asNetwork(re05)
net_re06 <- intergraph::asNetwork(re06)
net_re07 <- intergraph::asNetwork(re07)
net_re08 <- intergraph::asNetwork(re08)
net_re09 <- intergraph::asNetwork(re09)
net_re10 <- intergraph::asNetwork(re10)
net_re11 <- intergraph::asNetwork(re11)
net_re12 <- intergraph::asNetwork(re12)
net_re13 <- intergraph::asNetwork(re13)
net_re14 <- intergraph::asNetwork(re14)
net_re15 <- intergraph::asNetwork(re15)
net_re16 <- intergraph::asNetwork(re16)
net_re17 <- intergraph::asNetwork(re17)
net_re18 <- intergraph::asNetwork(re18)
net_re19 <- intergraph::asNetwork(re19)
net_re20 <- intergraph::asNetwork(re20)
net_re21 <- intergraph::asNetwork(re21)
net_re22 <- intergraph::asNetwork(re22)
net_re23 <- intergraph::asNetwork(re23)
```

```{r}
detach(package:igraph)
require(tergm)
require(sna)
```


# checking the vertex attributes,
```{r}
# Reference: https://cran.r-project.org/web/packages/network/network.pdf
list.vertex.attributes(net_re00)
list.vertex.attributes(net_re01)
list.vertex.attributes(net_re02)
list.vertex.attributes(net_re03)
list.vertex.attributes(net_re04)
list.vertex.attributes(net_re05)
list.vertex.attributes(net_re06)
list.vertex.attributes(net_re07)
list.vertex.attributes(net_re08)
list.vertex.attributes(net_re09)
list.vertex.attributes(net_re10)
list.vertex.attributes(net_re11)
list.vertex.attributes(net_re12)
list.vertex.attributes(net_re13)
list.vertex.attributes(net_re14)
list.vertex.attributes(net_re15)
list.vertex.attributes(net_re16)
list.vertex.attributes(net_re17)
list.vertex.attributes(net_re18)
list.vertex.attributes(net_re19)
list.vertex.attributes(net_re20)
list.vertex.attributes(net_re21)
list.vertex.attributes(net_re22)
list.vertex.attributes(net_re23)
```


```{r}
#library(sna)
#library(network)
library(networkDynamic)
```


#Hysteresis Effect
I am hashing the following chunk of codes that create a network dynamic object for hysteresis effect of reproducible cultural goods trade, which takes more than an hour to run. For faster reproducibility, I have saved it in 'results' folder and am loading it from there in the following code block along with 'RTA' network dynamic object. 

```{r}
#hyst_repro <- read.csv("../data/cleaned/edgelist_repro_hyst.csv",stringsAsFactors = FALSE)

#hyst_repro_n0 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
#set.edge.value(hyst_repro_n0, "X2000", hyst_repro$X2000)

# hyst_repro_n1 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n1, "X2001", hyst_repro$X2001)
# 
# hyst_repro_n2 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n2, "X2002", hyst_repro$X2002)
# 
# hyst_repro_n3 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n3, "X2003", hyst_repro$X2003)
# 
# hyst_repro_n4 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n4, "X2004", hyst_repro$X2004)
# 
# hyst_repro_n5 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n5, "X2005", hyst_repro$X2005)
# 
# hyst_repro_n6 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n6, "X2006", hyst_repro$X2006)
# 
# hyst_repro_n7 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n7, "X2007", hyst_repro$X2007)
# 
# hyst_repro_n8 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n8, "X2008", hyst_repro$X2008)
# 
# hyst_repro_n9 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n9, "X2009", hyst_repro$X2009)
# 
# hyst_repro_n10 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n10, "X2010", hyst_repro$X2010)

# hyst_repro_n11 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n11, "X2011", hyst_repro$X2011)
# 
# hyst_repro_n12 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n12, "X2012", hyst_repro$X2012)
# 
# hyst_repro_n13 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n13, "X2013", hyst_repro$X2013)
# 
# hyst_repro_n14 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n14, "X2014", hyst_repro$X2014)
# 
# hyst_repro_n15 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n15, "X2015", hyst_repro$X2015)
# 
# hyst_repro_n16 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n16, "X2016", hyst_repro$X2016)
# 
# hyst_repro_n17 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n17, "X2017", hyst_repro$X2017)
# 
# hyst_repro_n18 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n18, "X2018", hyst_repro$X2018)
# 
# hyst_repro_n19 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n19, "X2019", hyst_repro$X2019)
# 
# hyst_repro_n20 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n20, "X2020", hyst_repro$X2020)

# hyst_repro_n21 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n21, "X2021", hyst_repro$X2021)
# 
# hyst_repro_n22 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n22, "X2022", hyst_repro$X2022)
# 
# hyst_repro_n23 <- network(hyst_repro[, c("iso_o", "iso_d")], directed = TRUE, matrix.type = "edgelist", loops = FALSE)
# set.edge.value(hyst_repro_n23, "X2023", hyst_repro$X2023)
# 
# #get.edge.value(hyst_repro_n23, "X2023")
# class(hyst_repro_n23)

# net_dynamic_hyst_r <- networkDynamic(network.list = list(hyst_repro_n0, hyst_repro_n1, hyst_repro_n2, hyst_repro_n3, hyst_repro_n4, hyst_repro_n5, hyst_repro_n6, hyst_repro_n7, hyst_repro_n8, hyst_repro_n9, hyst_repro_n10, hyst_repro_n11, hyst_repro_n12, hyst_repro_n13, hyst_repro_n14, hyst_repro_n15, hyst_repro_n16, hyst_repro_n17, hyst_repro_n18, hyst_repro_n19, hyst_repro_n20, hyst_repro_n21, hyst_repro_n22, hyst_repro_n23),  verbose = TRUE)

#saveRDS(net_dynamic_hyst_r, file = "../results/net_dynamic_hyst_r.rds")
```

```{r}
net_dynamic_rta <- readRDS("../results/net_dynamic_rta.rds")
net_dynamic_hyst_r <- readRDS("../results/net_dynamic_hyst_r.rds")
```



# Estimating STERGM
Start: 27 July, 2025 at 09:12AM
End: 28 july, 2025 at 2:20PM
```{r}
#Reference: https://www.rdocumentation.org/packages/ergm/versions/4.8.1/topics/edgecov-ergmTerm

# set.seed(312)
# 
# repro_stgm <- tergm(list(net_re00, net_re01, net_re02, net_re03, net_re04, net_re05, net_re06, net_re07, net_re08, net_re09, net_re10, net_re11, net_re12, net_re13, net_re14, net_re15, net_re16, net_re17, net_re18, net_re19, net_re20, net_re21, net_re22, net_re23)~
#                                        Form(~edges + nodecov("D_log_gdp_pct")
#                                                    + absdiff("D_log_gdp_pct")
#                                                    + nodemix("development")
#                                                    + edgecov(net_dynamic_rta)
#                                                    + nodematch("landlocked")
#                                                    + edgecov(dist_net, "log_dist")
#                                                    + edgecov(contig_mat)
#                                                    + edgecov(colony)
#                                                    + edgecov(col_mat)
#                                                    + edgecov(lang_mat)
#                                                    + mutual) +
#                                     Persist(~edges + nodecov("D_log_gdp_pct")
#                                                    + absdiff("D_log_gdp_pct")
#                                                    + nodemix("development")
#                                                    + edgecov(net_dynamic_rta)
#                                                    + nodematch("landlocked")
#                                                    + edgecov(dist_net, "log_dist")
#                                                    + edgecov(contig_mat)
#                                                    + edgecov(colony)
#                                                    + edgecov(col_mat)
#                                                    + edgecov(lang_mat)
#                                                    + mutual), estimate = "CMLE", times = c(1:24))
```

```{r}
#summary(repro_stgm)
#saveRDS(repro_stgm, "../results/reproducible_stgm3.rds")
```

```{r}
repro_stgm <- readRDS("../results/reproducible_stgm3.rds")
```


```{r}
or_r <- exp(coef(repro_stgm))
pvals_r <- summary(repro_stgm)$coefficients[, "Pr(>|z|)"]
ste1 <- sqrt(diag(repro_stgm$covar))
lci1 <- exp(coef(repro_stgm) - 1.96 * ste1) # the lower bound of the 95% confidence interval (see https://en.wikipedia.org/wiki/1.96)
uci1 <- exp(coef(repro_stgm) + 1.96 * ste1) # the upper bound of the 95% confidence interval (see https://en.wikipedia.org/wiki/1.96)

oddsratios1 <- cbind(coef(repro_stgm), round(lci1, digits = 4), round(or_r, digits = 4), round(uci1, digits = 4), pvals_r)
dataframe_r1 = as.data.frame(oddsratios1)
dataframe_r1$model_terms <- rownames(dataframe_r1)
rownames(dataframe_r1) <- NULL
colnames(dataframe_r1) <- c('Estimates_r','lCI_r', 'odds_r','uCI_r', 'pvals_r', 'model_terms')
```

```{r}
#write.csv(dataframe_r1, "../results/reproducible_stgm3_results.csv")
```




## Goodness of fit statistics

```{r}
# AIC(repro_stgm)[1]
# BIC(repro_stgm)[1]
```


```{r}
mcmc.diagnostics(repro_stgm)
```

```{r}
# goftest_r <- gof(repro_stgm)
# plot(goftest_r)
# saveRDS(goftest_r, "../results/goftest_model3_r.rds")
goftest_r <- readRDS("../results/goftest_model3_r.rds")
```


```{r}

all_stats_3 <- c("odegree", "idegree", "espartners", "distance", "model")

# 2 to 5
selected_stats_3 <- all_stats_3[2:5]

tiff(file = "../results/goftest_model3_r.tiff",
     width = 12, height = 3, units = "in", res = 100)


par(mfrow = c(1, 4),
    mar = c(5, 5, 5, 1),
    oma = c(0.2, 1, 0.2, 1))


for (stat in selected_stats_3) {
  plot(goftest_r, which = stat, main = "Model 3", cex.lab = 1.5)
}

dev.off()

```

## Hysteresis Effect
Start: 31 July at 8:48PM
End: 2 July 6:44AM
```{r}
# set.seed(312)
# 
# repro_stgm_hyst <- tergm(list(net_re00, net_re01, net_re02, net_re03, net_re04, net_re05, net_re06, net_re07, net_re08, net_re09, net_re10, net_re11, net_re12, net_re13, net_re14, net_re15, net_re16, net_re17, net_re18, net_re19, net_re20, net_re21, net_re22, net_re23)~  
#                                               Form(~ nodecov("D_log_gdp_pct") 
#                                                    + absdiff("D_log_gdp_pct")
#                                                    + nodemix("development")
#                                                    + edgecov(net_dynamic_hyst_r)
#                                                    + edgecov(net_dynamic_rta)
#                                                    + nodematch("landlocked")
#                                                    + edgecov(dist_net, "log_dist")
#                                                    + edgecov(contig_mat)
#                                                    + edgecov(colony)
#                                                    + edgecov(col_mat)
#                                                    + edgecov(lang_mat)
#                                                    + mutual) +
#                                            Persist(~ nodecov("D_log_gdp_pct") 
#                                                    + absdiff("D_log_gdp_pct")
#                                                    + nodemix("development")
#                                                    + edgecov(net_dynamic_hyst_r)
#                                                    + edgecov(net_dynamic_rta)
#                                                    + nodematch("landlocked")
#                                                    + edgecov(dist_net, "log_dist")
#                                                    + edgecov(contig_mat)
#                                                    + edgecov(colony)
#                                                    + edgecov(col_mat)
#                                                    + edgecov(lang_mat)
#                                                    + mutual), estimate = "CMLE", times = c(1:24))
# 
# summary(repro_stgm_hyst)
```

```{r}
#saveRDS(repro_stgm_hyst, "../results/reproducible_stgm4.rds")
repro_stgm_hyst <- readRDS("../results/reproducible_stgm4.rds")
```

```{r}
or_r_h <- exp(coef(repro_stgm_hyst))
pvals_r_h <- summary(repro_stgm_hyst)$coefficients[, "Pr(>|z|)"]
ste_r_h <- sqrt(diag(repro_stgm_hyst$covar))
lci_r_h <- exp(coef(repro_stgm_hyst) - 1.96 * ste_r_h) # the lower bound of the 95% confidence interval (see https://en.wikipedia.org/wiki/1.96)
uci_r_h <- exp(coef(repro_stgm_hyst) + 1.96 * ste_r_h) # the upper bound of the 95% confidence interval (see https://en.wikipedia.org/wiki/1.96)

oddsratios_r_h <- cbind(coef(repro_stgm_hyst), round(lci_r_h, digits = 4), round(or_r_h, digits = 4), round(uci_r_h, digits = 4), pvals_r_h)
dataframe_r_h = as.data.frame(oddsratios_r_h)
dataframe_r_h$model_terms <- rownames(dataframe_r_h)
rownames(dataframe_r_h) <- NULL
colnames(dataframe_r_h) <- c('Estimates_r_h','lCI_r_h', 'odds_r_h','uCI_r_h', 'pvals_r_h', 'model_terms_h')
```

```{r}
#write.csv(dataframe_r_h, "../results/reproducible_stgm4_results.csv")
```

```{r}
mcmc.diagnostics(repro_stgm_hyst)
```

Start: 2 August, 2005 at 7:18AM
End: 2 August, 2005 almost 6 hours
```{r}
# goftest_r_hyst <- gof(repro_stgm_hyst) 
# plot(goftest_r_hyst)
# saveRDS(goftest_r_hyst, "../results/goftest_model4_r.rds")

goftest_r_hyst <- readRDS("../results/goftest_model4_r.rds")
```


```{r}
all_stats_4 <- c("odegree", "idegree", "espartners", "distance", "model")

# 2 to 5
selected_stats_4 <- all_stats_4[2:5]

tiff(file = "../results/goftest_model4_r.tiff",
     width = 12, height = 3, units = "in", res = 100)


par(mfrow = c(1, 4),
    mar = c(5, 5, 5, 1),
    oma = c(0.2, 1, 0.2, 1))


for (stat in selected_stats_4) {
  plot(goftest_r_hyst, which = stat, main = "Model 4", cex.lab = 1.5)
}

dev.off()
```












